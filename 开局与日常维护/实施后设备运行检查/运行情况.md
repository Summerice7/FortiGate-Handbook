# 运行情况

使用命令行的方式查看更详细的信息

1. 查看系统基本信息

   ```
   # get system status
   Version: FortiGate-501E v7.0.9,build0444,221121 (GA.M)
   Firmware Signature: certified
   Virus-DB: 90.08232(2022-11-27 22:26)
   Extended DB: 90.08232(2022-11-27 22:26)
   Extreme DB: 1.00000(2018-04-09 18:07)
   AV AI/ML Model: 2.08576(2022-11-27 21:45)
   IPS-DB: 6.00741(2015-12-01 02:30)
   IPS-ETDB: 22.00446(2022-11-24 01:49)
   APP-DB: 22.00444(2022-11-22 02:49)
   INDUSTRIAL-DB: 6.00741(2015-12-01 02:30)
   IPS Malicious URL Database: 4.00543(2022-11-27 12:14)
   Serial-Number: FG5H1Exxxxxx
   BIOS version: 05000005
   System Part-Number: P21592-08
   Log hard disk: Available
   Hostname: FGTxxxxxx
   Private Encryption: Disable
   Operation Mode: NAT
   Current virtual domain: root
   Max number of virtual domains: 10
   Virtual domains status: 1 in NAT mode, 0 in TP mode
   Virtual domain configuration: disable
   FIPS-CC mode: disable
   Current HA mode: standalone
   Branch point: 0444
   Release Version Information: GA
   FortiOS x86-64: Yes
   System time: Mon Nov 28 14:49:17 2022
   Last reboot reason: warm reboot
   ```

2. 查看硬件状态

   ```
   # get hardware status 
   Model name: FortiGate-501E
   ASIC version: CP9
   ASIC SRAM: 64M
   CPU: Intel(R) Core(TM) i7-6700 CPU @ 3.40GHz
   Number of CPUs: 8
   RAM: 16047 MB
   Compact Flash: 15331 MB /dev/sdc
   Hard disk: 228936 MB /dev/sda
   USB Flash: not available
   Network Card chipset: Intel(R) Gigabit Ethernet Linux Driver (rev.0003)
   Network Card chipset: FortiASIC NP6 Adapter (rev.)
   ```

3. 查看CPU和内存利用率

   ```
   # get system performance status 
   CPU states: 0% user 0% system 0% nice 100% idle 0% iowait 0% irq 0% softirq
   CPU0 states: 0% user 0% system 0% nice 100% idle 0% iowait 0% irq 0% softirq
   CPU1 states: 0% user 0% system 0% nice 100% idle 0% iowait 0% irq 0% softirq
   CPU2 states: 0% user 0% system 0% nice 100% idle 0% iowait 0% irq 0% softirq
   CPU3 states: 0% user 0% system 0% nice 100% idle 0% iowait 0% irq 0% softirq
   CPU4 states: 0% user 0% system 0% nice 100% idle 0% iowait 0% irq 0% softirq
   CPU5 states: 0% user 0% system 0% nice 100% idle 0% iowait 0% irq 0% softirq
   CPU6 states: 0% user 0% system 0% nice 100% idle 0% iowait 0% irq 0% softirq
   CPU7 states: 0% user 0% system 0% nice 100% idle 0% iowait 0% irq 0% softirq
   Memory: 16432720k total, 4086464k used (24.9%), 11961200k free (72.8%), 385056k freeable (2.3%)
   Average network usage: 191 / 2 kbps in 1 minute, 263 / 11 kbps in 10 minutes, 268 / 4 kbps in 30 minutes
   Maximal network usage: 283 / 42 kbps in 1 minute, 553 / 1422 kbps in 10 minutes, 553 / 1422 kbps in 30 minutes
   Average sessions: 11 sessions in 1 minute, 10 sessions in 10 minutes, 8 sessions in 30 minutes
   Maximal sessions: 16 sessions in 1 minute, 19 sessions in 10 minutes, 19 sessions in 30 minutes
   Average session setup rate: 0 sessions per second in last 1 minute, 0 sessions per second in last 10 minutes, 0 sessions per second in last 30 minutes
   Maximal session setup rate: 3 sessions per second in last 1 minute, 3 sessions per second in last 10 minutes, 3 sessions per second in last 30 minutes
   Average NPU sessions: 0 sessions in last 1 minute, 0 sessions in last 10 minutes, 0 sessions in last 30 minutes
   Maximal NPU sessions: 0 sessions in last 1 minute, 0 sessions in last 10 minutes, 0 sessions in last 30 minutes
   Average nTurbo sessions: 0 sessions in last 1 minute, 0 sessions in last 10 minutes, 0 sessions in last 30 minutes
   Maximal nTurbo sessions: 0 sessions in last 1 minute, 0 sessions in last 10 minutes, 0 sessions in last 30 minutes
   Virus caught: 0 total in 1 minute
   IPS attacks blocked: 0 total in 1 minute
   Uptime: 0 days,  4 hours,  10 minutes
   ```

4. 查看会话状态

   ```
   # diagnose sys session full-stat 
   session table:           table_size=4194304 max_depth=1 used=66
   misc info:       session_count=35 setup_rate=0 exp_count=0 clash=0
           memory_tension_drop=0 ephemeral=0/1113088 removeable=0 extreme_low_mem=0
           npu_session_count=0
           nturbo_session_count=0
   delete=6, flush=5, dev_down=98/137 ses_walkers=0
   TCP sessions:
            11 in ESTABLISHED state
            1 in TIME_WAIT state
   firewall error stat:
   error1=00000000
   error2=00000000
   error3=00000000
   error4=00000000
   tt=00000000
   cont=00000000
   ips_recv=00000000
   policy_deny=00006bae
   av_recv=00000000
   fqdn_count=00000001
   fqdn6_count=00000000
   ```

5. 查看HA状态

   ```
   # get system ha status 
   HA Health Status: OK
   Model: FortiGate-501E
   Mode: HA A-P
   Group: 0
   Debug: 0
   Cluster Uptime: 0 days 0:21:11
   Cluster state change time: 2022-11-28 15:13:06
   Primary selected using:
       <2022/11/28 15:13:06> FG5H1ExxxxxxB is selected as the primary because its uptime is larger than peer member FG5H1E5819904211.
       <2022/11/28 15:13:06> FG5H1ExxxxxxA is selected as the primary because its override priority is larger than peer member FG5H1E5819904036.
       <2022/11/28 15:10:15> FG5H1ExxxxxxA is selected as the primary because it's the only member in the cluster.
   ses_pickup: disable
   override: disable
   Configuration Status:
       FG5H1ExxxxxxA(updated 4 seconds ago): out-of-sync
       FG5H1ExxxxxxB(updated 0 seconds ago): in-sync
   System Usage stats:
       FG5H1ExxxxxxA(updated 4 seconds ago):
           sessions=11, average-cpu-user/nice/system/idle=0%/0%/0%/100%, memory=24%
       FG5H1ExxxxxxB(updated 0 seconds ago):
           sessions=17, average-cpu-user/nice/system/idle=0%/0%/1%/98%, memory=21%
   HBDEV stats:
       FG5H1ExxxxxxA(updated 4 seconds ago):
           port6: physical/1000full, up, rx-bytes/packets/dropped/errors=47426063/99344/0/0, tx=461507/1005/0/0
       FG5H1ExxxxxxB(updated 0 seconds ago):
           port6: physical/1000full, up, rx-bytes/packets/dropped/errors=1169224/2536/0/0, tx=3000908/6578/0/0
   Secondary   : FGT1, FG5H1ExxxxxxA, HA cluster index = 0
   Primary     : FGT2, FG5H1ExxxxxxB, HA cluster index = 1
   number of vcluster: 1
   vcluster 1: standby 169.254.0.2
   Secondary: FG5H1ExxxxxxA, HA operating index = 1
   Primary: FG5H1ExxxxxxA, HA operating index = 0
   ```

6. 查看crashlog是否异常

   ```
   # diagnose debug crashlog read
   1: 2022-11-23 17:32:57 the killed daemon is /bin/sflowd: status=0x0
   2: 2022-11-23 17:34:55 the killed daemon is /bin/dhcpd: status=0x0
   3: 2022-11-23 01:38:40 the killed daemon is /bin/getty: status=0x0
   4: 2022-11-23 01:41:32 the killed daemon is /bin/fgfmd: status=0x0
   5: 2022-11-28 10:41:47 the killed daemon is /bin/sflowd: status=0x0
   Crash log interval is 3600 seconds
   Max crash log line number: 16384
   ```

6. 查看进程状态

   ```
   # diagnose sys top 3 100 3    可判断每个进程的cpu和内存的利用率，敲一次c 按cpu高低排序；敲一次m，按mem高低排序，敲q退出
   第一个3是间隔3s，100是显示的进程数，最后一个3是执行3次
   Run Time:  0 days, 4 hours and 16 minutes
   0U, 0N, 0S, 100I, 0WA, 0HI, 0SI, 0ST; 16047T, 11679F
          ipshelper      228      S <     0.0     1.6    0
          ipsengine      357      S <     0.0     0.5    1
          ipsengine      360      S <     0.0     0.5    4
          ipsengine      363      S <     0.0     0.5    6
          ipsengine      358      S <     0.0     0.5    2
          ipsengine      361      S <     0.0     0.5    7
          ipsengine      362      S <     0.0     0.5    5
          ipsengine      359      S <     0.0     0.5    3
               node      215      S       0.0     0.3    1
            cmdbsvr      180      S       0.0     0.3    2
            miglogd      234      S       0.0     0.2    0
                wad      284      S       0.0     0.2    7
                wad      283      S       0.0     0.2    4
                wad      285      S       0.0     0.2    2
                wad      286      S       0.0     0.2    0
                wad      287      S       0.0     0.2    3
                wad      289      S       0.0     0.2    2
                wad      290      S       0.0     0.2    0
                wad      288      S       0.0     0.2    4
          scanunitd      238      S <     0.0     0.2    2
            miglogd      298      S       0.0     0.2    4
            miglogd      299      S       0.0     0.2    1
            miglogd      301      S       0.0     0.2    1
            miglogd      300      S       0.0     0.2    6
          forticron      222      S       0.0     0.1    2
          extenderd      266      S       0.0     0.1    0
             cw_acd      257      S       0.0     0.1    0
            updated      239      S       0.0     0.1    5
              fgfmd      256      S       0.0     0.1    0
             httpsd      214      S       0.0     0.1    4
            reportd      235      S       0.0     0.1    5
             newcli     1330      S       0.0     0.1    6
          scanunitd     1318      S <     0.0     0.1    6
          scanunitd     1319      S <     0.0     0.1    1
          scanunitd     1320      S <     0.0     0.1    6
          scanunitd     1321      S <     0.0     0.1    6
          scanunitd     1322      S <     0.0     0.1    2
          scanunitd     1323      S <     0.0     0.1    0
          scanunitd     1324      S <     0.0     0.1    2
          scanunitd     1325      S <     0.0     0.1    4
          forticldd      223      S       0.0     0.1    2
    initXXXXXXXXXXX        1      S       0.0     0.1    2
           dnsproxy      268      S       0.0     0.1    2
                wad      281      S       0.0     0.0    6
             cu_acd      261      S       0.0     0.0    0
             httpsd     1300      S       0.0     0.0    2
             fnbamd      220      S       0.0     0.0    2
              autod      267      S       0.0     0.0    2
              authd      224      S       0.0     0.0    0
             newcli     1357      R       0.0     0.0    1
              authd      312      S       0.0     0.0    5
              authd      311      S       0.0     0.0    2
              authd      313      S       0.0     0.0    1
              authd      314      S       0.0     0.0    2
          eap_proxy      255      S       0.0     0.0    1
         wf_monitor      245      S       0.0     0.0    2
            foauthd      225      S       0.0     0.0    0
                wad      237      S       0.0     0.0    6
               sshd      247      S       0.0     0.0    2
              voipd      236      S       0.0     0.0    2
              snmpd      240      S       0.0     0.0    6
             fcnacd      230      S       0.0     0.0    0
                nsm      198      S       0.0     0.0    0
            syslogd      219      S       0.0     0.0    2
             flcfgd      262      S       0.0     0.0    2
              radvd      251      S       0.0     0.0    4
              dhcpd      241      S       0.0     0.0    6
          urlfilter      377      S <     0.0     0.0    2
            wpad_ac      259      S       0.0     0.0    4
         fortilinkd      260      S       0.0     0.0    1
     zebos_launcher      193      S       0.0     0.0    2
              quard      250      S       0.0     0.0    0
      cw_acd_helper      258      S       0.0     0.0    7
               ntpd      246      S <     0.0     0.0    0
           dnsproxy      253      S       0.0     0.0    6
             lldptx      243      S       0.0     0.0    3
       ipmc_sensord      212      S       0.0     0.0    2
               sshd     1329      S       0.0     0.0    0
             lldprx      242      S       0.0     0.0    2
             flpold      263      S       0.0     0.0    6
            uploadd      211      S       0.0     0.0    6
         ipsmonitor      217      S       0.0     0.0    5
                acd      244      S       0.0     0.0    2
              getty      216      S <     0.0     0.0    4
          alertmail      252      S       0.0     0.0    6
                fsd      265      S       0.0     0.0    0
              fsvrd      249      S       0.0     0.0    2
                fas      229      S       0.0     0.0    6
                wad      279      S       0.0     0.0    4
            telnetd      248      S       0.0     0.0    3
     merged_daemons      218      S       0.0     0.0    6
          clearpass      226      S       0.0     0.0    1
          fsso_ldap      232      S       0.0     0.0    1
           kmiglogd      213      S       0.0     0.0    2
              xcvrd      233      S       0.0     0.0    4
           httpclid      227      S       0.0     0.0    2
          fclicense      221      S       0.0     0.0    6
                imi      210      S       0.0     0.0    6
               bgpd      203      S <     0.0     0.0    5
               pimd      205      S       0.0     0.0    0
   ```

   
